<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firecrawl Research Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .terminal { background-color: #0f172a; color: #38bdf8; font-family: 'Fira Code', monospace; height: 400px; overflow-y: auto; }
        .thought-line::before { content: "> "; color: #94a3b8; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans">
    <div class="max-w-7xl mx-auto p-6">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight">Firecrawl <span class="text-blue-600">Research Agent</span></h1>
            <div class="flex gap-2">
                <input type="text" id="topicInput" placeholder="Enter research topic..." 
                       class="w-96 p-3 rounded-xl border border-slate-200 shadow-sm focus:ring-2 focus:ring-blue-500 outline-none">
                <button onclick="startSearch()" id="searchBtn" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-700 transition-all">
                    Execute Agent
                </button>
            </div>
        </header>

        <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-5 space-y-4">
                <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                    <span>üì∞</span> Latest News & Web Results
                </h2>
                <div id="textResults" class="h-[800px] overflow-y-auto pr-4 custom-scrollbar space-y-4">
                    <div class="text-slate-400 italic p-8 bg-white rounded-2xl border border-dashed border-slate-300">
                        Results will appear here after execution...
                    </div>
                </div>
            </div>

            <div class="col-span-12 lg:col-span-7 space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <span>üñºÔ∏è</span> Visual Intelligence
                    </h2>
                    <div id="imageGallery" class="grid grid-cols-3 gap-3">
                        </div>
                </div>

                <div class="bg-slate-900 rounded-2xl shadow-2xl overflow-hidden">
                    <div class="bg-slate-800 px-4 py-2 flex items-center gap-2">
                        <div class="flex gap-1.5">
                            <div class="w-3 h-3 rounded-full bg-red-500"></div>
                            <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                            <div class="w-3 h-3 rounded-full bg-green-500"></div>
                        </div>
                        <span class="text-xs font-mono text-slate-400">agent-terminal ‚Äî bash</span>
                    </div>
                    <div id="terminal" class="terminal p-5 text-sm">
                        <div class="text-slate-500">System standby. Ready for input...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function startSearch() {
            const topic = document.getElementById('topicInput').value;
            if (!topic) return;

            const terminal = document.getElementById('terminal');
            const textResults = document.getElementById('textResults');
            const imageGallery = document.getElementById('imageGallery');
            const searchBtn = document.getElementById('searchBtn');

            terminal.innerHTML = '<div class="text-yellow-400">Booting Agent Pipeline...</div>';
            textResults.innerHTML = '<div class="p-8 text-center"><div class="animate-spin text-4xl mb-4">‚öôÔ∏è</div><p class="text-slate-500">Retrieving textual data...</p></div>';
            imageGallery.innerHTML = '';
            searchBtn.disabled = true;

            const eventSource = new EventSource(`/search-stream?topic=${encodeURIComponent(topic)}`);

            eventSource.onmessage = function(event) {
                const data = JSON.parse(event.data);

                if (data.type === 'thought') {
                    const div = document.createElement('div');
                    div.className = 'thought-line mb-1 opacity-80';
                    div.innerText = data.content;
                    terminal.appendChild(div);
                    terminal.scrollTop = terminal.scrollHeight;
                } 
                
                if (data.type === 'result') {
                    renderUI(data.content);
                    eventSource.close();
                    searchBtn.disabled = false;
                    terminal.innerHTML += '<div class="text-green-400 font-bold mt-4">Pipeline Execution Successful.</div>';
                }
            };
        }

        function renderUI(allData) {
            const textResults = document.getElementById('textResults');
            const imageGallery = document.getElementById('imageGallery');
            textResults.innerHTML = '';
            imageGallery.innerHTML = '';

            allData.forEach(batch => {
                // Handle News/Web Text
                const articles = [...(batch.news || []), ...(batch.web || [])];
                articles.forEach(item => {
                    const card = `
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition-shadow">
                            <h3 class="font-bold text-lg text-slate-900 leading-tight">
                                <a href="${item.url}" target="_blank" class="hover:text-blue-600">${item.title}</a>
                            </h3>
                            <p class="text-slate-600 text-sm mt-2 line-clamp-3">${item.snippet || item.description || ''}</p>
                            <div class="flex items-center justify-between mt-4">
                                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">${new URL(item.url).hostname}</span>
                                <span class="text-[10px] text-slate-400">${item.date || ''}</span>
                            </div>
                        </div>
                    `;
                    textResults.innerHTML += card;
                });

                // Handle Images
                if (batch.images) {
                    batch.images.slice(0, 9).forEach(img => {
                        const imgEl = `
                            <div class="relative group overflow-hidden rounded-xl aspect-square bg-slate-200">
                                <img src="${img.imageUrl}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                                <a href="${img.url}" target="_blank" class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity">
                                    <span class="text-white text-[10px] font-bold px-2 text-center">${img.title.substring(0, 30)}...</span>
                                </a>
                            </div>
                        `;
                        imageGallery.innerHTML += imgEl;
                    });
                }
            });
        }
    </script>
</body>
</html>